<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tìm kiếm sách</title>
    <link rel="stylesheet" href="/styles/headerStyle.css" />
    <link rel="stylesheet" href="/styles/searchFiledBook.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <script src="/scripts/searchFieldScript.js" defer></script>
  </head>
  <body>
    <%- include('partial/header') %>
    <%- include('partial/searchBar') %>

    <div class="search-field-container">
      <div class="field-container">
        <div class="field-content">LỌC THEO</div>
        <form>
          <div class="field-price">
            <div class="field-type">Giá:</div>
            <div class="field-value">
              <!-- <ol>
                <li><input type="checkbox" name="price" value="0-150000"><p>0đ - 150.000đ</p></li>
                <li><input type="checkbox" name="price" value="150000-300000"><p>150.000đ - 300.000đ</p></li>
                <li><input type="checkbox" name="price" value="300000-500000"><p>300.000đ - 500.000đ</p></li>
                <li><input type="checkbox" name="price" value="500000-700000"><p>500.000đ - 700.000đ</p></li>
                <li><input type="checkbox" name="price" value="700000-1000000"><p>700.000đ trở lên</p></li>
              </ol> -->
              <select name="" id="">
                <option value="">0đ - 150.000đ</option>
                <option value="">150.000đ - 300.000đ</option>
                <option value="">300000-500000</option>
                <option value="">500000-700000</option>
                <option value="">700000 trở lên</option>
              </select>
            </div>
          </div>
          <div class="field-pub">
            <div class="field-type">Nhà xuất bản:</div>
            <div class="field-value">
              <ol id="publisher-list">
                <% publishers.slice(0, 5).forEach(publisher => { %>
                <li><input type="checkbox" name="publisher" value="<%= publisher.pub_id %>"><p><%= publisher.publishing_house %></p></li>
                <% }) %>
                <% publishers.slice(5).forEach(publisher => { %>
                <li style="display: none;"><input type="checkbox" name="publisher" value="<%= publisher.pub_id %>"><p><%= publisher.publishing_house %></p></li>
                <% }) %>
              </ol>
              <% if (publishers.length > 5) { %>
              <div class="toggle-view">
                <button type="button" id="view-more-publisher">Xem thêm</button>
                <button type="button" id="view-less-publisher" style="display: none;">Hiển ít lại</button>
              </div>
              <% } %>
            </div>
          </div>
          <div class="field-author">
            <div class="field-type">Tác Giả:</div>
            <div class="field-value">
              <ol id="author-list">
                <% authors.slice(0, 5).forEach(author => { %>
                <li><input type="checkbox" name="author" value="<%= author.author_id %>"><p><%= author.lastname + " " + author.firstname %></p></li>
                <% }) %>
                <% authors.slice(5).forEach(author => { %>
                <li style="display: none;"><input type="checkbox" name="author" value="<%= author.author_id %>"><p><%= author.lastname + " " + author.firstname %></p></li>
                <% }) %>
              </ol>
              <% if (authors.length > 5) { %>
              <div class="toggle-view">
                <button type="button" id="view-more-author">Xem thêm</button>
                <button type="button" id="view-less-author" style="display: none;">Hiển ít lại</button>
              </div>
              <% } %>
            </div>
          </div>
          <button type="submit" class="btn-filter">Lọc</button>
        </form>
      </div>

      <div class="books-container">
        <div class="result-search">KẾT QUẢ TÌM KIẾM: <%= books.length %> sách</div>
        <div class="sort-by">
          <label for="sort">Sắp xếp theo:
          <select name="sort">
            <option value="relevance">Liên quan</option>
            <option value="title">Tên sách</option>
            <option value="price">Giá</option>
          </select>
        </div>
        <div class="book-list-result">
          <% paginatedBooks.forEach(book => {
            const authorsForBook = is_writtens
              .filter(written => written.book_id === book.book_id)
              .map(written => {
                const author = authors.find(author => author.author_id === written.author_id);
                return `${author.lastname} ${author.firstname}`;
              });
            
            const price = (book.book_id.startsWith('NO') || book.book_id.startsWith('RE'))
              ? editions.find(edition => edition.book_id === book.book_id)?.price
              : issues.find(issue => issue.book_id === book.book_id)?.price;

        
          %>
          <div class="book-item">
            <a href="/search/book/<%= book.book_id %>"><img src="../../images/book.png" alt="Book <%= book.book_id %>" class="book-cover" /></a>
            <div class="book-info">
              <h3><%= book.title %></h3>
              <div class="author-info"><strong>Tác giả:</strong> <span><%= authorsForBook.join(", ") %></span></div>
              <p class="price">Giá: <%= price ? price.toLocaleString() : "Không có thông tin" %> VND</p>
            </div>
          </div>
          <% }) %>
        </div>
        <div class="pagination">
          <% if (currentPage > 1) { %>
          <a href="?page=<%= currentPage - 1 %>">Trang trước</a>
          <% } %>
  
          <a href="?page=1">1</a>
  
          <% if (currentPage > 4) { %>
          <span>...</span>
          <% } %> <% for (let i = currentPage - 2; i <= currentPage + 2; i++) { %>
          <% if (i > 1 && i < totalPages) { %>
          <a
            href="?page=<%= i %>"
            class="<%= i === currentPage ? 'active' : '' %>"
            ><%= i %></a
          >
          <% } %> <% } %> <% if (currentPage < totalPages - 3) { %>
          <span>...</span>
          <% } %> <% if (totalPages > 1) { %>
          <a href="?page=<%= totalPages %>"><%= totalPages %></a>
          <% } %> <% if (currentPage < totalPages) { %>
          <a href="?page=<%= currentPage + 1 %>">Trang sau</a>
          <% } %>
        </div>
      </div>
    </div>
  </body>
</html>
